<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registrar Nuevo Socio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="/static/js/api.js"></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
  <header class="p-4 border-b border-slate-800 flex items-center justify-between">
    <h1 class="text-xl font-semibold">ü¶æ Panel de Recepci√≥n</h1>
    <nav class="space-x-3 text-sm">
      <a href="/" class="hover:underline">Logs</a>
      <a href="/registro" class="underline">Registrar Usuario</a>
      <a href="/eliminar" class="hover:underline">Eliminar Usuario</a>
    </nav>
  </header>

  <main class="max-w-3xl mx-auto p-6">
    <div class="bg-slate-800/70 border border-slate-700 rounded-2xl p-6">
      <h2 class="text-xl font-semibold mb-6">Registrar Nuevo Socio</h2>
      <form id="f" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm mb-1">Nombre</label>
          <input id="nombre" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg" placeholder="Ej: Juan" required />
        </div>
        <div>
          <label class="block text-sm mb-1">Apellido</label>
          <input id="apellido" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg" placeholder="Ej: P√©rez" required />
        </div>
        <div>
          <label class="block text-sm mb-1">DNI</label>
          <input id="dni" type="number" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg" placeholder="Ej: 40123456" required />
        </div>
        <div>
          <label class="block text-sm mb-1">Fecha de Nacimiento</label>
          <input id="nacimiento" type="date" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg" required />
        </div>
        <div>
          <label class="block text-sm mb-1">Tel√©fono</label>
          <input id="telefono" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg" placeholder="Ej: 1123456789" />
        </div>
        <div>
          <label class="block text-sm mb-1">Email</label>
          <input id="mail" type="email" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg" placeholder="Ej: ejemplo@mail.com" />
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm mb-1">Plan</label>
          <select id="plan" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg"></select>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm mb-1">Foto del socio</label>
          <input id="foto" type="file" accept="image/*" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg" required />
          <p class="text-xs text-slate-400 mt-1">La imagen se utiliza para generar autom√°ticamente el embedding facial y guardarlo en la base de datos.</p>
        </div>
        <div class="md:col-span-2 flex justify-end gap-2 mt-2">
          <a href="/" class="px-4 py-2 rounded-lg bg-slate-700">Cancelar</a>
          <button class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500">Guardar</button>
        </div>
      </form>
    </div>
  </main>

  <script>
    const api = API();
    async function loadPlanes(){
      const planes = await api.planes();
      const sel = document.getElementById('plan');
      sel.innerHTML = '';
      planes.forEach(p=>{
        const opt = document.createElement('option');
        opt.value = p.id_plan; opt.textContent = p.nombre; sel.appendChild(opt);
      })
    }
    loadPlanes();

    document.getElementById('f').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload = new FormData();
      payload.append('dni', document.getElementById('dni').value);
      payload.append('nombre', document.getElementById('nombre').value);
      payload.append('apellido', document.getElementById('apellido').value);
      payload.append('fecha_nacimiento', document.getElementById('nacimiento').value);
      payload.append('telefono', document.getElementById('telefono').value || '');
      payload.append('mail', document.getElementById('mail').value || '');
      payload.append('id_plan', document.getElementById('plan').value);
      payload.append('dias_duracion', '30');
      const fotoInput = document.getElementById('foto');
      if(fotoInput.files && fotoInput.files[0]){
        payload.append('foto', fotoInput.files[0]);
      }
      try{
        await api.altaSocio(payload);
        alert('Socio creado con √©xito');
        window.location.href = '/';
      }catch(err){
        alert('Error al crear socio');
        console.error(err);
      }
    });
  </script>
</body>
</html>
