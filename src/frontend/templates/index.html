<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel de Recepci√≥n ‚Äî Logs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="/static/js/api.js"></script>
</head>

<body class="bg-slate-900 text-slate-100 min-h-screen">
  <header class="p-4 border-b border-slate-800 flex items-center justify-between">
    <h1 class="text-xl font-semibold">ü¶æ Panel de Recepci√≥n</h1>
    <nav class="space-x-3 text-sm">
      <a href="/" class="underline">Logs</a>
      <a href="/registro" class="hover:underline">Registrar Usuario</a>
      <a href="/eliminar" class="hover:underline">Eliminar Usuario</a>
    </nav>
  </header>

  <main class="max-w-5xl mx-auto p-6">
    <h2 class="text-lg mb-4">Registros de Ingreso</h2>
    <div id="logs" class="space-y-3"></div>
  </main>

  <!-- CARGA LA API PRIMERO, SIN defer -->
  <script src="/static/js/api.js"></script>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // 1) Verificar que api.js realmente carg√≥
      if (typeof window.API !== 'function') {
        const cont = document.getElementById('logs');
        cont.innerHTML = '<div class="text-rose-400 text-sm">No se pudo cargar /static/js/api.js (API no definida).</div>';
        console.error('API() no est√° definida. ¬ø/static est√° montado? ¬øapi.js existe en /static/js/api.js?');
        return;
      }

      const api = window.API(); // 2) Instanciar API del helper

      function estadoClass(estado) {
        if (estado === 'PERMITIDO') return 'text-emerald-400';
        if (estado === 'DENEGADO') return 'text-rose-400';
        return 'text-slate-300';
      }
      function estadoLabel(estado) {
        if (estado === 'PERMITIDO') return '‚úî Ingreso permitido';
        if (estado === 'DENEGADO') return '‚úñ Ingreso denegado';
        return estado || '‚Äî';
      }

      async function loadLogs() {
        const cont = document.getElementById('logs');
        cont.innerHTML = '<div class="text-slate-400 text-sm">Cargando‚Ä¶</div>';
        try {
          const data = await api.logs(); // 3) AC√Å debe generarse un GET /logs (miralo en Network)
          cont.innerHTML = '';
          if (!data.length) {
            cont.innerHTML = '<div class="text-slate-400 text-sm">Sin registros a√∫n.</div>';
            return;
          }
          data.forEach(row => {
            const fecha = row.fecha_hora ? new Date(row.fecha_hora) : null;
            const hora = fecha ? fecha.toLocaleTimeString('es-AR') : '‚Äî';
            const card = document.createElement('div');
            card.className = 'bg-slate-800/60 border border-slate-700 rounded-xl p-4 flex items-center justify-between';
            card.innerHTML = `
              <div>
                <div class="font-medium">${row.nombre ? `${row.nombre} ${row.apellido}` : 'Nuevo Usuario'}</div>
                <div class="text-sm text-slate-300">Plan: ${row.plan || '‚Äî'}</div>
              </div>
              <div class="text-right">
                <div class="${estadoClass(row.estado)} text-sm">${estadoLabel(row.estado)}</div>
                <div class="text-xs text-slate-400">DNI ${row.dni || '‚Äî'} ‚Ä¢ ${hora}</div>
              </div>`;
            cont.appendChild(card);
          });
        } catch (e) {
          console.error('Error en loadLogs()', e);
          cont.innerHTML = `<div class="text-rose-400 text-sm">Error cargando logs: ${e.message}</div>`;
        }
      }

      loadLogs();
      setInterval(loadLogs, 5000);
    });
  </script>


</body>

</html>